<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Of Money - Manajemen Keuangan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: linear-gradient(45deg, #16213e 0%, #0f3460 100%);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(64, 224, 208, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        h1 {
            font-size: 2.5em;
            color: #40e0d0;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(64, 224, 208, 0.5);
            position: relative;
            z-index: 1;
        }

        .subtitle {
            color: #b0b0b0;
            font-size: 1.2em;
            position: relative;
            z-index: 1;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: linear-gradient(145deg, #1e1e2e 0%, #2a2a3e 100%);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #40e0d0, #48cae4, #40e0d0);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(64, 224, 208, 0.2);
        }

        .card h3 {
            color: #40e0d0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #b0b0b0;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #444;
            border-radius: 8px;
            background: #2a2a3e;
            color: #e0e0e0;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #40e0d0;
            box-shadow: 0 0 10px rgba(64, 224, 208, 0.3);
        }

        button {
            background: linear-gradient(45deg, #40e0d0 0%, #48cae4 100%);
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(64, 224, 208, 0.4);
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #333;
        }

        .summary-value {
            font-size: 2em;
            font-weight: bold;
            color: #40e0d0;
            margin-bottom: 5px;
        }

        .summary-label {
            color: #b0b0b0;
            font-size: 0.9em;
        }

        .transaction-list {
            background: linear-gradient(145deg, #1e1e2e 0%, #2a2a3e 100%);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #333;
            margin-top: 20px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #2a2a3e;
            border-radius: 8px;
            border-left: 4px solid #40e0d0;
            transition: all 0.3s ease;
        }

        .transaction-item:hover {
            background: #353545;
            transform: translateX(5px);
        }

        .transaction-desc {
            flex: 1;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1em;
        }

        .income {
            color: #4ade80;
        }

        .expense {
            color: #f87171;
        }

        .whatsapp-section {
            background: linear-gradient(145deg, #1e1e2e 0%, #2a2a3e 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid #333;
        }

        .whatsapp-btn {
            background: linear-gradient(45deg, #25d366 0%, #128c7e 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(37, 211, 102, 0.4);
        }

        .savings-calculator {
            background: linear-gradient(145deg, #1e1e2e 0%, #2a2a3e 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid #333;
        }

        .result {
            background: #2a2a3e;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #40e0d0;
        }

        .research-section {
            background: linear-gradient(145deg, #1e1e2e 0%, #2a2a3e 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid #333;
        }

        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .research-card {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #40e0d0;
            transition: all 0.3s ease;
        }

        .research-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(64, 224, 208, 0.15);
        }

        .chart-container {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            height: 300px;
            position: relative;
        }

        .tab-container {
            display: flex;
            border-bottom: 2px solid #333;
            margin-bottom: 20px;
        }

        .tab {
            background: none;
            border: none;
            padding: 10px 20px;
            color: #b0b0b0;
            cursor: pointer;
            transition: all 0.3s ease;
            width: auto;
            margin: 0 5px;
        }

        .tab.active {
            color: #40e0d0;
            border-bottom: 2px solid #40e0d0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .insight-card {
            background: linear-gradient(135deg, #2a2a3e 0%, #353545 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 4px solid #40e0d0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background: linear-gradient(145deg, #1e1e2e 0%, #2a2a3e 100%);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            border: 1px solid #333;
        }

        .close {
            color: #b0b0b0;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #40e0d0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 2em;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .research-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Management Of Money</h1>
            <p class="subtitle">Kelola Keuangan Kita dengan Mudah & Efisien</p>
        </header>

        <div class="summary">
            <div class="summary-card">
                <div class="summary-value" id="totalIncome">Rp 0</div>
                <div class="summary-label">Total Pemasukan</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="totalExpense">Rp 0</div>
                <div class="summary-label">Total Pengeluaran</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="balance">Rp 0</div>
                <div class="summary-label">Saldo</div>
            </div>
            <div class="summary-card">
                <div class="summary-value" id="dailyLimit">Rp 0</div>
                <div class="summary-label">Limit Harian</div>
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3> Tambah Pemasukan</h3>
                <div class="form-group">
                    <label>Deskripsi:</label>
                    <input type="text" id="incomeDesc" placeholder="Gaji, bonus, dll">
                </div>
                <div class="form-group">
                    <label>Jumlah:</label>
                    <input type="number" id="incomeAmount" placeholder="Jumlah dalam Rupiah">
                </div>
                <div class="form-group">
                    <label>Tanggal:</label>
                    <input type="date" id="incomeDate">
                </div>
                <button onclick="addIncome()">Tambah Pemasukan</button>
            </div>

            <div class="card">
                <h3> Tambah Pengeluaran</h3>
                <div class="form-group">
                    <label>Kategori:</label>
                    <select id="expenseCategory">
                        <option value="makanan">üçΩÔ∏è Makanan</option>
                        <option value="transportasi">üöó Transportasi</option>
                        <option value="belanja">üõçÔ∏è Belanja</option>
                        <option value="hiburan">üé¨ Hiburan</option>
                        <option value="kesehatan">üè• Kesehatan</option>
                        <option value="pendidikan">üìö Pendidikan</option>
                        <option value="lainnya">üì¶ Lainnya</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Deskripsi:</label>
                    <input type="text" id="expenseDesc" placeholder="Deskripsi pengeluaran">
                </div>
                <div class="form-group">
                    <label>Jumlah:</label>
                    <input type="number" id="expenseAmount" placeholder="Jumlah dalam Rupiah">
                </div>
                <div class="form-group">
                    <label>Tanggal:</label>
                    <input type="date" id="expenseDate">
                </div>
                <button onclick="addExpense()">Tambah Pengeluaran</button>
            </div>

            <div class="card">
                <h3> Kalkulator Tabungan</h3>
                <div class="form-group">
                    <label>Target Tabungan:</label>
                    <input type="number" id="savingsTarget" placeholder="Target dalam Rupiah">
                </div>
                <div class="form-group">
                    <label>Jangka Waktu (hari):</label>
                    <input type="number" id="savingsDays" placeholder="Berapa hari">
                </div>
                <div class="form-group">
                    <label>Pemasukan Bulanan:</label>
                    <input type="number" id="monthlyIncome" placeholder="Pemasukan per bulan">
                </div>
                <button onclick="calculateSavings()">Hitung Tabungan</button>
                <div id="savingsResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- Riset Keuangan Section -->
        <div class="research-section">
            <h3> Riset & Analisis Keuangan</h3>
            <div class="tab-container">
                <button class="tab active" onclick="showTab('overview')">Ringkasan</button>
                <button class="tab" onclick="showTab('analysis')">Analisis</button>
                <button class="tab" onclick="showTab('trends')">Tren</button>
                <button class="tab" onclick="showTab('recommendations')">Rekomendasi</button>
            </div>

            <div id="overview" class="tab-content active">
                <div class="research-grid">
                    <div class="research-card">
                        <h4> Pola Pengeluaran</h4>
                        <div id="expensePattern">Memuat data...</div>
                    </div>
                    <div class="research-card">
                        <h4> Kategori Tertinggi</h4>
                        <div id="topCategory">Memuat data...</div>
                    </div>
                    <div class="research-card">
                        <h4> Rata-rata Harian</h4>
                        <div id="dailyAverage">Memuat data...</div>
                    </div>
                    <div class="research-card">
                        <h4> Progress Target</h4>
                        <div id="targetProgress">Memuat data...</div>
                    </div>
                </div>
            </div>

            <div id="analysis" class="tab-content">
                <div class="insight-card">
                    <h4> Analisis Keuangan Mendalam</h4>
                    <div id="deepAnalysis">Memuat analisis...</div>
                </div>
                <div class="chart-container">
                    <h4> Grafik Perbandingan Pemasukan vs Pengeluaran</h4>
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

            <div id="trends" class="tab-content">
                <div class="insight-card">
                    <h4> Tren Pengeluaran 30 Hari Terakhir</h4>
                    <div id="monthlyTrend">Memuat tren...</div>
                </div>
                <div class="chart-container">
                    <h4> Grafik Tren Bulanan</h4>
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <div id="recommendations" class="tab-content">
                <div class="insight-card">
                    <h4> Rekomendasi Personal</h4>
                    <div id="personalRecommendations">Memuat rekomendasi...</div>
                </div>
                <div class="insight-card">
                    <h4> Tips Hemat</h4>
                    <div id="savingTips">Memuat tips...</div>
                </div>
            </div>
        </div>

        <div class="transaction-list">
            <h3> Riwayat Transaksi</h3>
            <div id="transactionHistory">
                <p style="text-align: center; color: #666; padding: 20px;">Belum ada transaksi</p>
            </div>
        </div>

        <!-- Personal WhatsApp Section -->
        <div class="whatsapp-section">
            <h3> Kirim Laporan ke WhatsApp Pribadi</h3>
            <div class="form-group">
                <label>Nomor WhatsApp Anda:</label>
                <input type="tel" id="userWhatsapp" placeholder="Contoh: 081234567890" value="">
            </div>
            <button onclick="openWhatsappModal()">Atur Nomor WhatsApp</button>
            <button onclick="sendReport()" style="background: linear-gradient(45deg, #25d366 0%, #128c7e 100%); color: white; margin-top: 10px;">
                  Kirim Laporan ke WhatsApp Saya
            </button>
            <div style="margin-top: 20px; padding: 15px; background: #2a2a3e; border-radius: 8px;">
                <h4> Fitur Laporan WhatsApp:</h4>
                <p>‚Ä¢ Ringkasan keuangan harian/bulanan</p>
                <p>‚Ä¢ Analisis pengeluaran per kategori</p>
                <p>‚Ä¢ Rekomendasi hemat berdasarkan pola spending</p>
                <p>‚Ä¢ Reminder target tabungan</p>
            </div>
        </div>
    </div>

    <!-- Modal untuk mengatur nomor WhatsApp -->
    <div id="whatsappModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeWhatsappModal()">&times;</span>
            <h3> Atur Nomor WhatsApp</h3>
            <div class="form-group">
                <label>Nomor WhatsApp (dengan kode negara):</label>
                <input type="tel" id="modalWhatsapp" placeholder="Contoh: 6281234567890">
                <small style="color: #b0b0b0;">Format: 62 untuk Indonesia, tanpa tanda + atau 0 di depan</small>
            </div>
            <button onclick="saveWhatsappNumber()">Simpan Nomor</button>
        </div>
    </div>

    <script>
        // Data storage
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            whatsappNumber: ''
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setTodayDate();
            updateSummary();
            displayTransactions();
            loadUserSettings();
            generateResearchData();
        });

        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('incomeDate').value = today;
            document.getElementById('expenseDate').value = today;
        }

        function loadUserSettings() {
            if (settings.whatsappNumber) {
                document.getElementById('userWhatsapp').value = settings.whatsappNumber;
            }
        }

        function addIncome() {
            const desc = document.getElementById('incomeDesc').value;
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const date = document.getElementById('incomeDate').value;

            if (!desc || !amount || !date) {
                alert('Mohon lengkapi semua field!');
                return;
            }

            const transaction = {
                id: Date.now(),
                type: 'income',
                category: 'pemasukan',
                description: desc,
                amount: amount,
                date: date,
                timestamp: new Date().toISOString()
            };

            transactions.push(transaction);
            saveData();
            updateSummary();
            displayTransactions();
            generateResearchData();
            clearIncomeForm();

            showNotification('Pemasukan berhasil ditambahkan!', 'success');
        }

        function addExpense() {
            const category = document.getElementById('expenseCategory').value;
            const desc = document.getElementById('expenseDesc').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const date = document.getElementById('expenseDate').value;

            if (!desc || !amount || !date) {
                alert('Mohon lengkapi semua field!');
                return;
            }

            const transaction = {
                id: Date.now(),
                type: 'expense',
                category: category,
                description: desc,
                amount: amount,
                date: date,
                timestamp: new Date().toISOString()
            };

            transactions.push(transaction);
            saveData();
            updateSummary();
            displayTransactions();
            generateResearchData();
            clearExpenseForm();

            showNotification('Pengeluaran berhasil ditambahkan!', 'success');
        }

        function calculateSavings() {
            const target = parseFloat(document.getElementById('savingsTarget').value);
            const days = parseInt(document.getElementById('savingsDays').value);
            const monthlyIncome = parseFloat(document.getElementById('monthlyIncome').value);

            if (!target || !days || !monthlyIncome) {
                alert('Mohon lengkapi semua field!');
                return;
            }

            const dailySavings = target / days;
            const dailyIncome = monthlyIncome / 30;
            const maxDailyExpense = dailyIncome - dailySavings;

            const resultDiv = document.getElementById('savingsResult');
            resultDiv.innerHTML = `
                <h4> Hasil Perhitungan:</h4>
                <p><strong>Target Tabungan:</strong> ${formatCurrency(target)}</p>
                <p><strong>Durasi:</strong> ${days} hari</p>
                <p><strong>Nabung per hari:</strong> ${formatCurrency(dailySavings)}</p>
                <p><strong>Pemasukan harian:</strong> ${formatCurrency(dailyIncome)}</p>
                <p><strong>Batas pengeluaran harian:</strong> ${formatCurrency(maxDailyExpense)}</p>
                ${maxDailyExpense < 0 ? '<p style="color: #f87171;"><strong> Peringatan:</strong> Target terlalu tinggi untuk pemasukan Anda!</p>' : ''}
            `;
            resultDiv.style.display = 'block';

            // Update daily limit
            document.getElementById('dailyLimit').textContent = formatCurrency(Math.max(0, maxDailyExpense));
        }

        function updateSummary() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const balance = totalIncome - totalExpense;

            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
            document.getElementById('balance').textContent = formatCurrency(balance);
        }

        function displayTransactions() {
            const historyDiv = document.getElementById('transactionHistory');

            if (transactions.length === 0) {
                historyDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Belum ada transaksi</p>';
                return;
            }

            const sortedTransactions = transactions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            historyDiv.innerHTML = sortedTransactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-desc">
                        <strong>${transaction.description}</strong><br>
                        <small>${getCategoryIcon(transaction.category)} ${transaction.category} ‚Ä¢ ${formatDate(transaction.date)}</small>
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                    </div>
                </div>
            `).join('');
        }

        function getCategoryIcon(category) {
            const icons = {
                'makanan': 'üçΩÔ∏è',
                'transportasi': 'üöó',
                'belanja': 'üõçÔ∏è',
                'hiburan': 'üé¨',
                'kesehatan': 'üè•',
                'pendidikan': 'üìö',
                'pemasukan': 'üí∞',
                'lainnya': 'üì¶'
            };
            return icons[category] || 'üì¶';
        }

        function generateResearchData() {
            // Expense Pattern Analysis
            const expenses = transactions.filter(t => t.type === 'expense');
            const categoryTotals = {};

            expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });

            const topCategory = Object.keys(categoryTotals).reduce((a, b) =>
                categoryTotals[a] > categoryTotals[b] ? a : b, 'Belum ada data');

            // Daily Average
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

            const recentExpenses = expenses.filter(e => new Date(e.date) >= thirtyDaysAgo);
            const dailyAverage = recentExpenses.length > 0 ?
                recentExpenses.reduce((sum, e) => sum + e.amount, 0) / 30 : 0;

            // Update research displays
            document.getElementById('expensePattern').innerHTML = `
                <p><strong>${expenses.length}</strong> transaksi bulan ini</p>
                <p>Rata-rata per transaksi: <strong>${formatCurrency(expenses.reduce((sum, e) => sum + e.amount, 0) / expenses.length || 0)}</strong></p>
            `;

            document.getElementById('topCategory').innerHTML = `
                <p>${getCategoryIcon(topCategory)} <strong>${topCategory}</strong></p>
                <p>${formatCurrency(categoryTotals[topCategory] || 0)}</p>
            `;

            document.getElementById('dailyAverage').innerHTML = `
                <p><strong>${formatCurrency(dailyAverage)}</strong> per hari</p>
                <p>Dalam 30 hari terakhir</p>
            `;

            // Target Progress
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const savingsRate = totalIncome > 0 ? ((totalIncome - totalExpense) / totalIncome * 100) : 0;

            document.getElementById('targetProgress').innerHTML = `
                <p><strong>${savingsRate.toFixed(1)}%</strong> tingkat tabungan</p>
                <p>${savingsRate >= 20 ? ' Excellent!' : savingsRate >= 10 ? ' Good!' : ' Perlu ditingkatkan'}</p>
            `;

            // Generate deeper analysis
            generateDeepAnalysis();
            generateRecommendations();
            generateTrendAnalysis();
        }

        function generateDeepAnalysis() {
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense');

            // Category analysis
            const categoryTotals = {};
            expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });

            const categoryAnalysis = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b - a)
                .map(([category, amount]) => {
                    const percentage = totalExpense > 0 ? (amount / totalExpense * 100).toFixed(1) : 0;
                    return `<p>${getCategoryIcon(category)} <strong>${category}:</strong> ${formatCurrency(amount)} (${percentage}%)</p>`;
                }).join('');

            // Financial health indicators
            const savingsRate = totalIncome > 0 ? (totalIncome - totalExpense) / totalIncome * 100 : 0;
            let healthStatus = '';
            let healthColor = '';

            if (savingsRate >= 20) {
                healthStatus = 'Sangat Sehat - Anda menghemat lebih dari 20% pendapatan!';
                healthColor = '#4ade80';
            } else if (savingsRate >= 10) {
                healthStatus = 'Sehat - Tingkat tabungan yang baik.';
                healthColor = '#40e0d0';
            } else if (savingsRate >= 0) {
                healthStatus = 'Perlu Perbaikan - Cobalah untuk menabung lebih banyak.';
                healthColor = '#f59e0b';
            } else {
                healthStatus = 'Perhatian - Pengeluaran melebihi pemasukan!';
                healthColor = '#f87171';
            }

            document.getElementById('deepAnalysis').innerHTML = `
                <div style="margin-bottom: 20px; padding: 15px; background: #353545; border-radius: 8px; border-left: 4px solid ${healthColor};">
                    <h5> Status Kesehatan Keuangan</h5>
                    <p><strong>${healthStatus}</strong></p>
                    <p>Tingkat Tabungan: <strong>${savingsRate.toFixed(1)}%</strong></p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h5> Breakdown Pengeluaran per Kategori:</h5>
                    ${categoryAnalysis || '<p>Belum ada data pengeluaran</p>'}
                </div>

                <div style="margin-bottom: 20px; padding: 15px; background: #353545; border-radius: 8px;">
                    <h5> Statistik Keuangan:</h5>
                    <p><strong>Total Transaksi:</strong> ${transactions.length}</p>
                    <p><strong>Rata-rata Pengeluaran:</strong> ${formatCurrency(totalExpense / Math.max(expenses.length, 1))}</p>
                    <p><strong>Pengeluaran Terbesar:</strong> ${expenses.length > 0 ? formatCurrency(Math.max(...expenses.map(e => e.amount))) : 'Rp 0'}</p>
                </div>
            `;
        }

        function generateRecommendations() {
            const expenses = transactions.filter(t => t.type === 'expense');
            const totalExpense = expenses.reduce((sum, e) => sum + e.amount, 0);
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);

            // Category totals for recommendations
            const categoryTotals = {};
            expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });

            let recommendations = [];

            // Generate personalized recommendations
            if (totalIncome > 0) {
                const savingsRate = (totalIncome - totalExpense) / totalIncome * 100;

                if (savingsRate < 10) {
                    recommendations.push('üéØ <strong>Target Utama:</strong> Tingkatkan tingkat tabungan ke minimal 10% dari pemasukan.');
                }

                if (categoryTotals['makanan'] && categoryTotals['makanan'] / totalExpense > 0.4) {
                    recommendations.push('üçΩÔ∏è <strong>Makanan:</strong> Pengeluaran makanan tinggi. Coba masak di rumah lebih sering.');
                }

                if (categoryTotals['hiburan'] && categoryTotals['hiburan'] / totalExpense > 0.2) {
                    recommendations.push('üé¨ <strong>Hiburan:</strong> Alokasi hiburan bisa dikurangi untuk meningkatkan tabungan.');
                }

                if (categoryTotals['transportasi'] && categoryTotals['transportasi'] / totalExpense > 0.3) {
                    recommendations.push('üöó <strong>Transportasi:</strong> Pertimbangkan opsi transportasi yang lebih ekonomis.');
                }
            }

            // Default recommendations if no specific issues
            if (recommendations.length === 0) {
                recommendations = [
                    'üí° <strong>Budgeting:</strong> Buat anggaran bulanan untuk setiap kategori pengeluaran.',
                    'üì± <strong>Tracking:</strong> Catat semua pengeluaran harian untuk kontrol yang lebih baik.',
                    'üéØ <strong>Emergency Fund:</strong> Siapkan dana darurat setara 3-6 bulan pengeluaran.'
                ];
            }

            document.getElementById('personalRecommendations').innerHTML = recommendations.map(rec => `<p>${rec}</p>`).join('');

            // Saving tips
            const savingTips = [
                'üí∞ <strong>Rule 50/30/20:</strong> 50% kebutuhan, 30% keinginan, 20% tabungan.',
                'üõí <strong>Belanja Cerdas:</strong> Buat daftar belanja dan patuhi anggaran.',
                '‚òï <strong>Small Expenses:</strong> Kurangi pembelian kecil yang sering (kopi, snack).',
                'üí° <strong>Bills Review:</strong> Review tagihan bulanan, batalkan langganan yang tidak perlu.',
                'üéØ <strong>Automated Saving:</strong> Set auto-transfer ke rekening tabungan.',
                'üì± <strong>Price Comparison:</strong> Bandingkan harga sebelum membeli barang mahal.'
            ];

            const randomTips = savingTips.sort(() => 0.5 - Math.random()).slice(0, 3);
            document.getElementById('savingTips').innerHTML = randomTips.map(tip => `<p>${tip}</p>`).join('');
        }

        function generateTrendAnalysis() {
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

            const recentTransactions = transactions.filter(t => new Date(t.date) >= thirtyDaysAgo);
            const recentExpenses = recentTransactions.filter(t => t.type === 'expense');
            const recentIncome = recentTransactions.filter(t => t.type === 'income');

            // Weekly trend
            const weeklyData = {};
            recentExpenses.forEach(expense => {
                const weekKey = getWeekKey(new Date(expense.date));
                weeklyData[weekKey] = (weeklyData[weekKey] || 0) + expense.amount;
            });

            const weeks = Object.keys(weeklyData).sort();
            let trendDirection = 'stabil';

            if (weeks.length >= 2) {
                const firstWeek = weeklyData[weeks[0]] || 0;
                const lastWeek = weeklyData[weeks[weeks.length - 1]] || 0;

                if (lastWeek > firstWeek * 1.1) {
                    trendDirection = 'meningkat';
                } else if (lastWeek < firstWeek * 0.9) {
                    trendDirection = 'menurun';
                }
            }

            const avgWeeklyExpense = Object.values(weeklyData).reduce((sum, val) => sum + val, 0) / Math.max(weeks.length, 1);

            document.getElementById('monthlyTrend').innerHTML = `
                <div style="padding: 15px; background: #353545; border-radius: 8px; margin-bottom: 15px;">
                    <h5>üìä Analisis Tren 30 Hari:</h5>
                    <p><strong>Tren Pengeluaran:</strong> ${getTrendIcon(trendDirection)} ${trendDirection}</p>
                    <p><strong>Rata-rata Mingguan:</strong> ${formatCurrency(avgWeeklyExpense)}</p>
                    <p><strong>Total Minggu Dianalisis:</strong> ${weeks.length}</p>
                </div>

                <div style="padding: 15px; background: #353545; border-radius: 8px;">
                    <h5>üí° Insight Tren:</h5>
                    ${getTrendInsight(trendDirection, recentExpenses.length, recentIncome.length)}
                </div>
            `;
        }

        function getWeekKey(date) {
            const year = date.getFullYear();
            const week = Math.ceil((date - new Date(year, 0, 1)) / (7 * 24 * 60 * 60 * 1000));
            return `${year}-W${week}`;
        }

        function getTrendIcon(direction) {
            const icons = {
                'meningkat': 'üìà',
                'menurun': 'üìâ',
                'stabil': '‚û°Ô∏è'
            };
            return icons[direction];
        }

        function getTrendInsight(direction, expenseCount, incomeCount) {
            let insight = '';

            switch(direction) {
                case 'meningkat':
                    insight = '<p>‚ö†Ô∏è Pengeluaran Anda cenderung meningkat. Pertimbangkan untuk meninjau anggaran dan mengurangi pengeluaran tidak penting.</p>';
                    break;
                case 'menurun':
                    insight = '<p>‚úÖ Bagus! Pengeluaran Anda menunjukkan tren menurun. Pertahankan kebiasaan berhemat ini.</p>';
                    break;
                default:
                    insight = '<p>üìä Pengeluaran Anda relatif stabil. Ini menunjukkan konsistensi dalam pengelolaan keuangan.</p>';
            }

            if (expenseCount > incomeCount * 3) {
                insight += '<p>üí° Anda memiliki banyak transaksi pengeluaran. Pertimbangkan untuk menggabungkan pembelian agar lebih efisien.</p>';
            }

            return insight;
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function openWhatsappModal() {
            document.getElementById('whatsappModal').style.display = 'block';
            document.getElementById('modalWhatsapp').value = settings.whatsappNumber || '';
        }

        function closeWhatsappModal() {
            document.getElementById('whatsappModal').style.display = 'none';
        }

        function saveWhatsappNumber() {
            const whatsappNumber = document.getElementById('modalWhatsapp').value.trim();

            if (!whatsappNumber) {
                alert('Mohon masukkan nomor WhatsApp!');
                return;
            }

            // Basic validation
            if (!/^\d{10,15}$/.test(whatsappNumber)) {
                alert('Format nomor tidak valid! Gunakan format: 6281234567890');
                return;
            }

            settings.whatsappNumber = whatsappNumber;
            document.getElementById('userWhatsapp').value = whatsappNumber;
            saveData();
            closeWhatsappModal();
            showNotification('Nomor WhatsApp berhasil disimpan!', 'success');
        }

        function sendReport() {
            const whatsappNumber = settings.whatsappNumber || document.getElementById('userWhatsapp').value.trim();

            if (!whatsappNumber) {
                alert('Mohon atur nomor WhatsApp terlebih dahulu!');
                openWhatsappModal();
                return;
            }

            // Generate comprehensive report
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpense;
            const savingsRate = totalIncome > 0 ? ((totalIncome - totalExpense) / totalIncome * 100).toFixed(1) : 0;

            // Category breakdown
            const expenses = transactions.filter(t => t.type === 'expense');
            const categoryTotals = {};
            expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });

            const topCategories = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([category, amount]) => `${getCategoryIcon(category)} ${category}: ${formatCurrencySimple(amount)}`)
                .join('\n');

            const report = `
*LAPORAN KEUANGAN MONEYKU*
Tanggal: ${new Date().toLocaleDateString('id-ID')}

*RINGKASAN KEUANGAN:*
‚Ä¢ Total Pemasukan: ${formatCurrencySimple(totalIncome)}
‚Ä¢ Total Pengeluaran: ${formatCurrencySimple(totalExpense)}
‚Ä¢ Saldo: ${formatCurrencySimple(balance)}
‚Ä¢ Tingkat Tabungan: ${savingsRate}%

*TOP 3 KATEGORI PENGELUARAN:*
${topCategories || 'Belum ada data'}

*STATUS:* ${savingsRate >= 20 ? 'Sangat Sehat! üéâ' : savingsRate >= 10 ? 'Sehat üëç' : 'Perlu Perbaikan ‚ö†Ô∏è'}

*SARAN:* ${getSuggestionText(savingsRate, categoryTotals, totalExpense)}

---
Dikirim otomatis dari Management Of Money
            `.trim();

            const encodedReport = encodeURIComponent(report);
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedReport}`;

            window.open(whatsappUrl, '_blank');
            showNotification('Laporan berhasil dikirim ke WhatsApp!', 'success');
        }

        function getSuggestionText(savingsRate, categoryTotals, totalExpense) {
            if (savingsRate < 10) {
                return 'Tingkatkan tabungan dengan mengurangi pengeluaran tidak penting.';
            } else if (categoryTotals['makanan'] && categoryTotals['makanan'] / totalExpense > 0.4) {
                return 'Pengeluaran makanan tinggi, coba masak di rumah lebih sering.';
            } else if (categoryTotals['hiburan'] && categoryTotals['hiburan'] / totalExpense > 0.2) {
                return 'Kurangi pengeluaran hiburan untuk meningkatkan tabungan.';
            } else {
                return 'Pertahankan kebiasaan menabung yang baik!';
            }
        }

        function formatCurrencySimple(amount) {
            return `Rp ${amount.toLocaleString('id-ID')}`;
        }
